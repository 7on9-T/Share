Day08 基础入门-算法分析&传输加密&数据格式&密文存储&代码混淆&逆向保护  
=
建议观看视频-MD5为何不再安全
-
<https://www.bilibili.com/video/BV1S541127qR>

2004年，山东大学王小云教授找到了快速大量MD5真碰撞的方法，发现了MD5的碰撞原理震惊了全世界。  

>1、	存储密码加密-应用对象  
2、	传输加密编码-发送回显  
3、	数据传输格式-统一格式  
4、	代码特性混淆-开发语言  


#传输数据-编码型&加密型等    
影响：漏洞探针  
	
#传输格式-常规&JSON&XML等  
影响：发送漏洞探针,回显数据分析  
	
#密码存储-Web&系统&三方应用  
例：   
-ZZZCMS&Dz  
-Win&Linux  
-MSSQL&MYSQL  
影响：安全后渗透测试  
	
#代码混淆-源代码加密&逆向保护  
例：  
-PHP&JS混淆加密  
-EXE&JAR代码保护  
影响：代码审计，逆向破解  

例子
- 
```
https://indialms.in/wfp_login.php?r_id=1  
https://indialms.in/wfp_login.php?r_id=MQ==  
```
这里的'MQ=='经过Base64解码其实就是1，数据在传输的时候会进行编码   

为什么要了解?  
-
对方服务器可能会在接受的时候进行解码在带入  
如果我们还是按照原有思路不对自己的Pay1oad进行同样编码的话  
传入过去的东西就是服务器不认识的东西 测试无效  
安全测试漏洞时候 通常都会进行数据的修改增加提交测试  

正确:测试的话也要进行payload同样的加密或编码进行提交  

登录的数据包
admin 123456

数据传输的时候会进行MD5加密:  
username=admin&password=123456  
username=admin&password=e10adc3949ba59abbe56e057f20f883e
	
如果现在我要进行密码的破解爆破  
字典文件：  
帐号什么都不用更改 去替换username=值即可  
密码需要进行密码算法 保证和password=值同等加密才行  
	
https://tv.sohu.com/v/dXMvMzg1MjM2NzE5LzQyNzUyODUzOC5zaHRtbA==.html  
其实经过Base64解码，就是下面这样  
https://tv.sohu.com/v/us/385236719/427528538.shtml  
	
开发：数组 列表

代码审计
-
btnPost=%E7%99%BB%E5%BD%95&username=admin and &password=e10adc3949ba59abbe56e057f20f883e&savedate=1  
	
		btnPost:"%E7%99%BB%E5%BD%95"；
	
	{
	
		username:"admin";
		password:"e10adc3949ba59abbe56e057f20f883e and";
		savedate:1;
	}
	
	
	json xml 常规
	x=123
```json
	x=123
	{
		x:123
	}
```
	
	zzzcms admin /123456 密文利用md5加密
	
	md5(123456)=密文
	
	dz3.2 admin /123456 
	
	md5(md5(123456).salt)=密文
	
	dz3.5 admin / 123456
	aes des（密匙 偏移量 填充 模式等）
	$2y$10$OtsSmawENczg1BLcQCEn5OdLqJC9GLiDrClwEUooNnn8b609DfJc.
	
	大部分的解密都是碰撞式解密
	不是算法的逆向的还原解密
	
1.常见加密编码进制等算法解析  
MD5，SHA，ASC，进制，时间戳，URL，BASE64，Unescape，AES，DES等  
2.常见加密编码形式算法解析  
直接加密，带salt，带密码，带偏移，带位数，带模式，带干扰，自定义组合等  
3.常见解密解码方式（针对）  
枚举，自定义逆向算法，可逆向  
4.常见加密解码算法的特性  
长度位数，字符规律，代码分析，搜索获取等  
	
#本课意义：  
1.了解加密编码进制在安全测试中的存在  
2.掌握常见的加密解密编码解码进制互转的操作  
3.了解常见的加密解密编码解密进制互转的影响  
	
识别算法编码方法：  
1、看密文位数  
2、看密文的特征（数字，字母，大小写，符号等）  
3、看当前密文存在的地方（Web，数据库，操作系统等应用）  
	
#拓展补充参考资料：  
-传输数据编码：  
BASE64 URL HEX ASCII   
BASE64值是由数字"0-9"和字母"a-f"所组成的字符串,大小写敏感,结尾通常有符号=  
URL编码是由数字"0-9"和字母"a-f"所组成的字符串,大小写敏感,通常以%数字字母间隔  
HEX编码是计算机中数据的一种表示方法,将数据进行十六进制转换,它由0-9,A-F,组成  
ASCII编码是将128个字符进行进制数来表示,常见ASCII码表大小规则：0~9<A~Z<a~z  
-传输数据加密：同密码存储加密  
-传输数据格式：常规字符串 JSON XML等   
	
-密码存储加密：  
MD5 SHA1 NTLM AES DES RC4  
MD5值是32或16位位由数字"0-9"和字母"a-f"所组成的字符串  
SHA1这种加密的密文特征跟MD5差不多，只不过位数是40  
NTLM这种加密是Windows的哈希密码，标准通讯安全协议  
AES,DES,RC4这些都是非对称性加密算法，引入密钥，密文特征与Base64类似  
	
代码混淆：  
JS前端代码加密：  
JS颜文字 jother JSFUCK  
https://jsfuck.com/  
颜文字特征：一堆颜文字构成的js代码，在F12中可直接解密执行  
jother特征：只用! + ( ) [ ] { }这八个字符就能完成对任意字符串的编码。也可在F12中解密执行  
JSFUCK特征：与jother很像，只是少了{ }  
	
后端代码混淆：  
PHP .NET JAVA  
PHP：乱码，头部有信息   
.NET：DLL封装代码文件，加保护  
JAVA：JAR&CLASS文件，，加保护  
举例：加密平台 Zend ILSpy IDEA  
应用场景：版权代码加密，开发特性，CTF比赛等  
	
特定应用-数据库密文加密：  
MYSQL MSSQL Oracle Redis 等  
	
数据显示编码：  
UTF-8 GBK2312等  
	
部分资源：  
https://www.cmd5.com  
http://www.jsfuck.com  
http://www.hiencode.com  
http://tool.chacuo.net/cryptaes  
https://utf-8.jp/public/aaencode.html  
https://github.com/guyoung/CaptfEncoder  
https://blog.csdn.net/qq_40837276/article/details/83080460  

Windows-NTLM
-
Windows-NTLM（NT LAN Manager）是一种在Windows网络环境中广泛使用的身份验证协议和密码哈希算法。
1. **发展历程**：它最初是作为Windows NT操作系统的一部分开发的，用于替代较旧且安全性较低的LM（LanManager）身份验证协议。随着Windows操作系统的不断发展，NTLM也经历了多个版本的演进，以提高安全性和性能。
2. **工作原理**：当用户尝试访问受保护的资源（如文件服务器、网站等）时，客户端会向服务器发送一个包含用户名的身份验证请求。服务器收到请求后，会向客户端发送一个随机生成的挑战字符串（challenge）。客户端使用用户的密码哈希值对该挑战字符串进行加密，并将加密后的结果发送回服务器。服务器在自己的用户账户数据库中查找该用户名对应的密码哈希值，然后使用相同的哈希值对挑战字符串进行加密，并将加密结果与客户端发送的结果进行比较。如果两者匹配，则身份验证成功。
3. **密码存储**：在Windows系统中，用户的密码以哈希值的形式存储在本地安全账户数据库（SAM）或Active Directory中。NTLM使用一种称为NTLM哈希的算法来计算密码的哈希值。与LM哈希相比，NTLM哈希更安全，因为它使用了更强大的加密算法和更长的密钥。
4. **安全性问题**：尽管NTLM在设计上比LM更安全，但它仍然存在一些安全漏洞。例如，NTLM哈希可以通过网络嗅探等方式被捕获，并且由于其加密算法的一些特性，可能会受到离线字典攻击和暴力破解的威胁。此外，NTLM协议在处理身份验证请求时，可能会导致中间人攻击的风险。为了应对这些安全问题，微软建议在可能的情况下使用更安全的身份验证协议，如Kerberos。Kerberos是一种基于票据的身份验证协议，它使用对称密钥加密和票据授权服务器（TGS）来提供更强大的身份验证和授权功能。 
5. **应用场景**：虽然Kerberos是Windows网络中推荐的身份验证协议，但NTLM仍然在一些特定场景中被使用。例如，在一些不支持Kerberos的旧版应用程序或非Windows操作系统中，可能需要使用NTLM进行身份验证。此外，在一些跨域的身份验证场景中，NTLM也可能作为备用的身份验证机制。 

Mimikatz
-
Mimikatz 是一款功能强大的开源后渗透测试工具，由法国安全研究员 Benjamin Delpy（网名 gentilkiwi）开发，主要用于 Windows 操作系统环境。  
功能特点  
1.	密码提取：能够从 Windows 系统内存中提取各种登录凭证信息，比如明文密码、哈希值等。例如可以获取本地登录用户的密码哈希，这对于后续进行密码破解或者尝试横向移动、权限提升等渗透测试环节十分有用。  
2.	票据操作：支持对 Kerberos 票据进行相关操作，像导出、注入票据等。攻击者可以利用这些功能，凭借合法获取的票据来冒充合法用户访问相应的网络资源，实现权限维持或在域环境中进行权限扩展等操作。  
3.	凭证获取与利用：除了常规的密码和票据外，还能获取如 Windows 的本地管理员账户密码、域用户账户密码等各类认证相关的凭证，方便攻击者在受控制的目标网络中进一步渗透、扩大控制范围。  
合法用途  
1.	安全测试：在经过授权的渗透测试场景中，安全专业人员可以使用 Mimikatz 来评估企业网络环境的安全性，检测系统是否存在可被利用的密码存储、传输等方面的漏洞，进而帮助企业更好地完善安全防护策略，提升整体安全水平。  
2.	应急响应：当怀疑系统遭受入侵，安全人员可以利用它来查看是否有非法获取的凭证信息遗留在内存中，辅助分析入侵的途径、范围以及攻击者可能获取到的权限等情况，以便采取有效的应对和恢复措施。  

Linux /etc/shadow
-
在Linux系统中，`/etc/shadow` 文件是用于存储用户密码等重要信息的文件。
1. **文件权限**：`/etc/shadow` 文件具有严格的权限设置，通常只有 root 用户可以读取和写入。普通用户无法直接查看该文件内容，这是为了保护用户密码等敏感信息不被非法获取，其权限一般为 `0000` 或 `0600`，这进一步增强了系统的安全性。 
2. **文件格式**：`/etc/shadow` 文件中的每一行对应一个用户的相关信息，字段之间使用冒号 `:` 分隔，每行包含多个字段，主要内容如下：
    - **用户名**：与 `/etc/passwd` 文件中的用户名相对应，是用户登录系统时使用的名称。
    - **加密密码**：存储的是经过加密处理的用户密码。常见的加密算法有 MD5、SHA-256、SHA-512 等。如果该字段为 `x` 或 `*`，表示用户不能使用密码登录，可能使用其他身份验证方式（如密钥对）。若该字段为空，则表示该用户无需密码即可登录系统，这在一些特殊场景或测试环境中可能会出现，但在生产环境中具有较大安全风险。 
    - **密码最后一次修改时间**：从 1970 年 1 月 1 日起到密码最后一次修改的天数。这个时间戳用于计算密码的有效期等信息。
    - **密码最短使用期限**：表示用户在修改密码后，至少要经过多少天才能再次修改密码。设置为 `0` 则表示可以随时修改密码。 
    - **密码最长使用期限**：指定密码在多少天后会过期，过期后用户需要修改密码才能继续正常使用系统。如果设置为一个较大的值或 `99999`，表示密码永不过期。 
    - **密码过期警告期限**：在密码即将过期前的多少天，系统会向用户发出密码即将过期的警告信息，提醒用户及时修改密码。 
    - **账号失效宽限期**：密码过期后，用户仍然可以在这个宽限期内登录系统，但登录时会收到提示需要尽快修改密码。若超过这个宽限期，账号将被锁定。 
    - **账号的生命周期（从 1970 年 1 月 1 日开始的天数）**：该字段相对较少使用，主要用于记录账号的有效时间范围，当达到指定天数后，账号可能会被自动锁定或失效。 
3. **作用**：`/etc/shadow` 文件与 `/etc/passwd` 文件配合使用，前者专门用于存储敏感的密码及相关信息，后者则存储用户的基本信息，如用户 ID、主目录、登录 shell 等。通过这种分离存储的方式，既能满足系统对用户信息管理的需求，又能最大程度地保障密码等关键信息的安全。 

例如，以下是 `root` 用户在 `/etc/shadow` 中的一行示例：
```
root:$6$XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX$XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:18644:0:99999:7:::
```
其中，`$6$` 表示使用 SHA-512 加密算法，后面的两组长字符串分别是加密盐值和加密后的密码。后面的数字字段则依次对应上述介绍的各项时间参数。 


Virbox Protector 
https://shell.virbox.com/
